<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PJSK 歌曲紀錄表</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #252542;
            --text-color: #fff;
            --easy: #448AFF;
            --normal: #64DD17;
            --hard: #FFD600;
            --expert: #D50000;
            --master: #AA00FF;
            --append: #f5f5f5; /* 類白色 */
            --fc-color: #ff69b4;
            --ap-color: linear-gradient(45deg, #FFD700, #FFF, #FFD700);
        }


        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-bottom: 80px; /* 預留底部按鈕空間 */
        }


        /* 頂部導航 */
        .header {
            background: rgba(30, 30, 50, 0.95);
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #333;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }


        /* 歌曲列表容器 */
        #songList {
            padding: 10px;
            max-width: 600px;
            margin: 0 auto;
        }


        /* 歌曲卡片 */
        .song-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            border: 1px solid #3a3a5e;
        }


        .song-header {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
        }


        .song-img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            background-color: #333;
            margin-right: 15px;
            border: 2px solid #fff;
        }


        .song-title {
            font-size: 1.1rem;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }


        .delete-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 1.2rem;
            padding: 5px 10px;
        }


        /* 難度列表 */
        .diff-list {
            padding: 5px 10px 15px 10px;
        }


        .diff-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }


        .diff-label {
            width: 90px;
            font-size: 0.9rem;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-between;
        }


        /* 難度顏色標籤 */
        .bg-easy { background-color: var(--easy); }
        .bg-normal { background-color: var(--normal); }
        .bg-hard { background-color: var(--hard); color: #333 !important; text-shadow: none; }
        .bg-expert { background-color: var(--expert); }
        .bg-master { background-color: var(--master); }
        .bg-append { background: linear-gradient(90deg, #ddd, #fff); color: #333 !important; text-shadow: none;}


        .status-btns {
            display: flex;
            gap: 8px;
        }


        .btn-toggle {
            background: #333;
            border: 1px solid #555;
            color: #888;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 45px;
        }


        /* 激活狀態樣式 */
        .btn-toggle.fc-active {
            background-color: var(--fc-color);
            color: white;
            box-shadow: 0 0 8px var(--fc-color);
            border-color: var(--fc-color);
        }


        .btn-toggle.ap-active {
            background: var(--ap-color);
            color: #6e4900;
            box-shadow: 0 0 10px #FFD700;
            border-color: #FFD700;
        }


        /* 懸浮新增按鈕 (FAB) */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #00d2ff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 4px 15px rgba(0,210,255,0.4);
            cursor: pointer;
            border: none;
            z-index: 200;
        }


        /* 新增視窗 (Modal) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 300;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }


        .modal-content {
            background: #252542;
            width: 100%;
            max-width: 400px;
            padding: 20px;
            border-radius: 15px;
            max-height: 90vh;
            overflow-y: auto;
        }


        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #ccc; }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            background: #1a1a2e;
            border: 1px solid #444;
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
        }


        .level-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }


        .btn-submit {
            width: 100%;
            padding: 12px;
            background-color: #00d2ff;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        .btn-close {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid #555;
            color: #aaa;
            border-radius: 6px;
        }


    </style>
</head>
<body>


    <div class="header">
        PJSK 紀錄本
    </div>


    <div id="songList">
        <div style="text-align:center; color:#666; margin-top:50px;">
            目前沒有歌曲<br>點擊右下角 + 按鈕新增
        </div>
    </div>


    <button class="fab" onclick="openModal()">+</button>


    <div class="modal" id="addModal">
        <div class="modal-content">
            <h2 style="margin-top:0;">新增歌曲</h2>
            
            <div class="form-group">
                <label>歌曲名稱</label>
                <input type="text" id="inputTitle" placeholder="例如: Tell Your World">
            </div>


            <div class="form-group">
                <label>歌曲封面 (選填)</label>
                <input type="file" id="inputImg" accept="image/*" style="color:#fff;">
            </div>


            <label>各難度等級 (輸入數字)</label>
            <div class="level-grid">
                <div class="form-group"><label style="color:var(--easy)">Easy</label><input type="number" id="lvEasy"></div>
                <div class="form-group"><label style="color:var(--normal)">Normal</label><input type="number" id="lvNormal"></div>
                <div class="form-group"><label style="color:var(--hard)">Hard</label><input type="number" id="lvHard"></div>
                <div class="form-group"><label style="color:var(--expert)">Expert</label><input type="number" id="lvExpert"></div>
                <div class="form-group"><label style="color:var(--master)">Master</label><input type="number" id="lvMaster"></div>
                <div class="form-group"><label style="color:#ddd">Append</label><input type="number" id="lvAppend" placeholder="無則留空"></div>
            </div>


            <button class="btn-submit" onclick="addSong()">確認新增</button>
            <button class="btn-close" onclick="closeModal()">取消</button>
        </div>
    </div>


<script>
    // 初始化資料
    let songs = JSON.parse(localStorage.getItem('pjsk_songs')) || [];
    const difficulties = ['easy', 'normal', 'hard', 'expert', 'master', 'append'];
    const diffLabels = ['EASY', 'NORMAL', 'HARD', 'EXPERT', 'MASTER', 'APPEND'];
    const diffClasses = ['bg-easy', 'bg-normal', 'bg-hard', 'bg-expert', 'bg-master', 'bg-append'];


    // 頁面載入時渲染
    window.onload = renderSongs;


    function renderSongs() {
        const container = document.getElementById('songList');
        container.innerHTML = '';


        if (songs.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#666; margin-top:50px;">目前沒有歌曲<br>點擊右下角 + 按鈕新增</div>';
            return;
        }


        songs.forEach((song, index) => {
            let diffHtml = '';
            
            difficulties.forEach((diff, dIndex) => {
                const lv = song.levels[diff];
                // 如果 Append 沒有等級，就不顯示該行
                if (diff === 'append' && !lv) return;


                const fcClass = song.status[diff].fc ? 'fc-active' : '';
                const apClass = song.status[diff].ap ? 'ap-active' : '';


                diffHtml += `
                    <div class="diff-row">
                        <div class="diff-label ${diffClasses[dIndex]}">
                            <span>${diffLabels[dIndex]}</span>
                            <span>${lv || '-'}</span>
                        </div>
                        <div class="status-btns">
                            <button class="btn-toggle ${fcClass}" onclick="toggleStatus(${index}, '${diff}', 'fc')">FC</button>
                            <button class="btn-toggle ${apClass}" onclick="toggleStatus(${index}, '${diff}', 'ap')">AP</button>
                        </div>
                    </div>
                `;
            });


            const card = document.createElement('div');
            card.className = 'song-card';
            // 預設圖片
            const imgSrc = song.image || 'https://via.placeholder.com/60/333333/FFFFFF?text=No+Img';


            card.innerHTML = `
                <div class="song-header">
                    <img src="${imgSrc}" class="song-img" alt="cover">
                    <div class="song-title">${song.title}</div>
                    <button class="delete-btn" onclick="deleteSong(${index})">×</button>
                </div>
                <div class="diff-list">
                    ${diffHtml}
                </div>
            `;
            container.appendChild(card);
        });
    }


    function openModal() {
        document.getElementById('addModal').style.display = 'flex';
    }


    function closeModal() {
        document.getElementById('addModal').style.display = 'none';
        // 清空輸入框
        document.querySelectorAll('input').forEach(input => input.value = '');
    }


    function addSong() {
        const title = document.getElementById('inputTitle').value;
        if (!title) {
            alert('請輸入歌曲名稱');
            return;
        }


        const levels = {
            easy: document.getElementById('lvEasy').value,
            normal: document.getElementById('lvNormal').value,
            hard: document.getElementById('lvHard').value,
            expert: document.getElementById('lvExpert').value,
            master: document.getElementById('lvMaster').value,
            append: document.getElementById('lvAppend').value,
        };


        const fileInput = document.getElementById('inputImg');
        const file = fileInput.files[0];


        // 處理圖片轉 Base64
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                saveSongData(title, levels, e.target.result);
            };
            reader.readAsDataURL(file);
        } else {
            saveSongData(title, levels, null);
        }
    }


    function saveSongData(title, levels, imageBase64) {
        const newSong = {
            id: Date.now(),
            title: title,
            image: imageBase64,
            levels: levels,
            status: {
                easy: { fc: false, ap: false },
                normal: { fc: false, ap: false },
                hard: { fc: false, ap: false },
                expert: { fc: false, ap: false },
                master: { fc: false, ap: false },
                append: { fc: false, ap: false }
            }
        };


        songs.unshift(newSong); // 加到最前面
        localStorage.setItem('pjsk_songs', JSON.stringify(songs));
        closeModal();
        renderSongs();
    }


    function toggleStatus(songIndex, diff, type) {
        const status = songs[songIndex].status[diff];


        if (type === 'fc') {
            // 如果原本是 FC，取消 FC 並連帶取消 AP
            if (status.fc) {
                status.fc = false;
                status.ap = false;
            } else {
                // 如果原本沒 FC，開啟 FC
                status.fc = true;
            }
        } else if (type === 'ap') {
            // 如果原本是 AP，取消 AP (FC 保持)
            if (status.ap) {
                status.ap = false;
            } else {
                // 如果原本沒 AP，開啟 AP 並強制開啟 FC
                status.ap = true;
                status.fc = true;
            }
        }


        localStorage.setItem('pjsk_songs', JSON.stringify(songs));
        renderSongs();
    }


    function deleteSong(index) {
        if(confirm('確定要刪除這首歌嗎？')) {
            songs.splice(index, 1);
            localStorage.setItem('pjsk_songs', JSON.stringify(songs));
            renderSongs();
        }
    }
</script>
</body>
</html>